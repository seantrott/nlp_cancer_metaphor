---
title: "Metaphor Analysis in Kickstarter Campaigns"
output:
  html_document:
    toc: yes
  pdf_document:
    toc: yes
---

**Sean Trott and Alex Liebscher**

# Introduction

We have several dependent variables which we would like to model as accurately as possible to determine the variables which contribute most to their outcomes. In particular, we care about the effect of the metaphor (or lack thereof) in each project. We first explore the data a little, and then begin a series of model comparisons for the dependent variables. Comparing models gives transparency to the contributions of each variable toward the target.

1. Do projects that use metaphor generally receive better funding? How does using metaphor (and which type of metaphor family) influence campaign success, number of backers, and mean donation?

2. Does higher metaphor productivity change the result?

3. How can we characterize projects by the metaphors they employ?

4. Within a metaphor family, are there canonical instantiations of a metaphor? (E.g. "fight battle"). Or even if productivity is low generally, are instantiations varied?

5. How does metaphor vary with other interesting features, such as project description length, goal amount, project type/category, cancer type, or recipient gender?

# Related Work

Hendricks, R. K., Demjén, Z., Semino, E., & Boroditsky, L. (2018). Emotional Implications of Metaphor: Consequences of Metaphor Framing for Mindset about Cancer. Metaphor and Symbol, 33(4), 267–279. https://doi.org/10.1080/10926488.2018.1549835

Semino, E., Demjén, Z., Demmen, J., Koller, V., Payne, S., Hardie, A., & Rayson, P. (2017). The online use of Violence and Journey metaphors by patients with cancer, as compared with health professionals: a mixed methods study. BMJ Supportive & Palliative Care, 7(1), 60–66. https://doi.org/10.1136/bmjspcare-2014-000785


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Load Data

```{r cars}
dat <- read.csv('../../data/processed/gofundme_projects.csv')
head(dat)
```

```{r}
nrow(dat)
colnames(dat)
```

```{r}
library(lme4)
library(tidyverse)
```

# Data Exploration

### Projects per year

```{r}
ggplot(dat) + geom_bar(aes(year), stat="count") + ggtitle("Number of projects per year")
```

There are very few projects before 2015, and so for simplicity's sake and to simplify the model just a tad, we remove 2013 and 2014.

```{r}
dat = dat[dat$year >= 2015, ]
```

### Projects per month

```{r}
dat$month <- factor(dat$month)

dat %>%
  ggplot() + labs(title="Counts in Months") +
  geom_bar(aes(month)) +
  scale_x_discrete(labels = c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"))
```

Interestingly, there are a ton of January projects. This might have to do with scraping the site which lists projects chronologically.

### Projects per day of the week

```{r}
dat$day_of_week <- factor(dat$day_of_week)

dat %>%
  ggplot() + labs(title="Counts in Days of the Week") +
  geom_bar(aes(day_of_week)) +
  scale_x_discrete(labels = c("Mon", "Tue", "Wed", "Thur", "Fri", "Sat", "Sun"))
```

### Projects from the US

```{r}
ggplot(dat) + geom_bar(aes(x=factor(from_US)), stat="count") + labs(x="From US", title="Number of projects from US")
```

Most projects are US based. Reduce the model complexity by restricting to US then.

```{r}
dat <- dat[dat$from_US == 1, ]
```

### Project durations

Kickstarter projects are usually given 30 days to meet their goal, so most projects revolve around that duration. Some are shorter and some are longer though. Categorize each of those bins.

```{r}
probs = c(0.0, 0.1, 0.25, 0.5, 0.75, 0.9, 1.0)
labs = c("a", "b", "c", "d", "e", "f")
quants = quantile(dat$duration_float, probs, names=F)

dat$duration_cat = ""

for (i in 1:6) {
  dat[dat$duration_float >= quants[i] & dat$duration_float <= quants[i+1], ]$duration_cat = labs[i]
}
dat$duration_cat = factor(dat$duration_cat, ordered = T, levels = labs)

dat %>%
  ggplot() + labs(title = "Duration Categories") +
  geom_bar(aes(duration_cat, fill=duration_cat), position="dodge")
```

### Metaphor instantiation

Where is the first metaphor instantiated? If it comes within the first quarter of the text, does that make a difference, compared to the second quarter or second half? Categorize each project.

```{r}
dat$inst = ""
dat[dat$first_instantiation == -1.0, ]$inst = "none"
dat[dat$first_instantiation >= 0 & dat$first_instantiation < 0.25, ]$inst = "firstquarter"
dat[dat$first_instantiation >= 0.25 & dat$first_instantiation < 0.5, ]$inst = "secondquarter"
dat[dat$first_instantiation >= 0.5, ]$inst = "secondhalf"

dat$inst = factor(dat$inst)

dat %>%
  ggplot() + labs(x="First Metaphor Instantiation Category", title="Counts in First Metaphor Instantiation Categories") +
  geom_bar(aes(inst)) +
  scale_x_discrete(labels = c("No Metaphor", "First Quarter", "Second Quarter", "Second Half"))
```

### Project goals, text lengths, and cancer types

We scale/z-score the continuous variables according to how we wish to interpret the coefficients of the model. From Andrew Gelman: "Standardizing puts things on an approximately common scale .... (Standarize for) comparing coefficients for different predictors within a model". Binary and categorical variables are left as is.

```{r}
dat$goal_sc <- scale(dat$goal)

dat %>%
  ggplot() + labs(title="Goal Amount Distribution") +
  geom_density(aes(goal))

dat$text_length_words_sc <- scale(dat$text_length_words)

dat %>%
  ggplot() + labs(title="Text Length Distribution") +
  geom_density(aes(text_length_words))

dat %>%
  ggplot() + labs(title="Cancer Type Counts") +
  geom_bar(aes(x=cancer_type)) +
  theme(axis.text.x=element_text(angle = 60, hjust=1))
```

### Project metaphors

No metaphor (b = 0 & j = 0)
Any metaphor (b > 0 || j > 0)
Some journey (j > 0)
Some battle (b > 0)
Some journey, no battle (b = 0 & j > 0)
Some battle, no journey (b > 0 & j = 0)
Some both (b > 0 & j > 0)

We break down each project into how the metaphor families are distributed within the project. Very few projects have both metaphors (< 25), are dominated by journey metaphors (< 25), or have only journey metaphors (< 20). 

```{r}
dat$no_metaphor = dat$battle_salience == 0.0 & dat$journey_salience == 0.0
dat$any_metaphor = 1 - dat$no_metaphor
dat$dom_journey = dat$journey_salience > dat$battle_salience
dat$dom_battle = dat$battle_salience > dat$journey_salience
dat$only_journey = dat$journey_salience > 0 & dat$battle_salience == 0.0
dat$only_battle = dat$journey_salience == 0.0 & dat$battle_salience > 0
dat$both_metaphor = dat$battle_salience > 0.0 & dat$journey_salience > 0.0

metaphor_counts = data.frame(counts = colSums(dat[, c("no_metaphor", "any_metaphor", "dom_journey", "dom_battle", "only_journey", "only_battle", "both_metaphor")]))

ggplot() + labs(x="Metaphor Type", y="Count", title="Count in Metaphor Types") +
  geom_bar(stat="identity", aes(x=row.names(metaphor_counts), y=metaphor_counts$counts))
```

Seem like comprehensive sources:
https://bbolker.github.io/mixedmodels-misc/glmmFAQ.html#model-definition
https://ase.tufts.edu/gsc/gradresources/guidetomixedmodelsinr/mixed%20model%20guide.html

# Primary Analyses

We are interested in the effect that metaphor presence has on the funding status of a project.

**DV**: status, backers, mean donation
**IV**: Goal amount, staff pick, category, text length words, duration category, year, metaphor instantiation, metaphor family salience, metaphor productivity

Various sources were used to determine what should be a random effect and what should be fixed, and how to model interactions and correlations between variables, including:

 - Data Analysis Using Regression and Multilevel/Hierarchical Models (Gelman and Hill, 2006)
 - Interactions in Generalized Linear Models: Theoretical Issues and an Application to Personal Vote-Earning Attributes (Tsai and Gill, 2013)
 - Should I Use Fixed or Random Effects? (Clark and Linzer, 2012)
 - Random effects structure for confirmatory hypothesis testing: Keep it maximal (Barr et al., 2013)
 - https://stats.stackexchange.com/questions/13166/rs-lmer-cheat-sheet
 - https://stats.stackexchange.com/questions/4700/what-is-the-difference-between-fixed-effect-random-effect-and-mixed-effect-mode/151800#151800
 - https://rlbarter.github.io/Practical-Statistics/2017/03/03/fixed-mixed-and-random-effects/
 - https://stats.stackexchange.com/questions/323273/what-to-do-with-random-effects-correlation-that-equals-1-or-1
 - Fitting linear mixed-effects models using lme4 (Bates et al., 2014)

# Status

```{r}
nrow(dat)
```

In total, we have 800 iid samples to work with.

```{r}
dat %>%
  ggplot() + labs(title="Goal Amount Distribution") + guides(color=guide_legend(title="Status")) +
  geom_density(aes(goal, color=fct_recode(factor(status), "Successful"="1", "Failed"="0")))

dat %>%
  ggplot() + labs(title="Text Length Distribution") + guides(color=guide_legend(title="Status")) +
  geom_density(aes(text_length_words, color=fct_recode(factor(status), "Successful"="1", "Failed"="0")))

dat %>%
  ggplot() + labs(title="Cancer Type Counts") + guides(fill=guide_legend(title="Status")) +
  geom_bar(aes(x=cancer_type, fill=fct_recode(factor(status), "Successful"="1", "Failed"="0")), position="dodge") +
  theme(axis.text.x=element_text(angle = 60, hjust=1))

```

Removed all random variabes except year because they didn't help explain any variance in the data beyond what the residuals could capture.

Nesting and Chi2 differences:
https://www.psychologie.uzh.ch/dam/jcr:ffffffff-b371-2797-0000-00000fda8f29/chisquare_diff_en.pdf

## Model status

```{r}
# no fixed effects, only random
mod.none <- glmer(status ~ (1|year), 
                  data = dat, family = "binomial", nAGQ = 0)


# add duration category
mod.dur <- glmer(status ~ duration_cat + (1|year), 
                       data = dat, family = "binomial", nAGQ = 0)

# add length of text (in words)
mod.dur.length <- glmer(status ~ text_length_words_sc + duration_cat + (1|year), 
                              data = dat, family = "binomial", nAGQ = 0)

# add scaled goal amount
mod.dur.length.goal <- glmer(status ~ goal_sc + text_length_words_sc + duration_cat + (1|year), 
                                   data = dat, family = "binomial", nAGQ = 0)

# add first instantiation
mod.dur.length.goal.inst <- glmer(status ~ inst + goal_sc + text_length_words_sc + duration_cat + (1|year), 
                                         data = dat, family = "binomial", nAGQ = 0)

anova(mod.none, mod.dur, test='Chisq')
anova(mod.dur, mod.dur.length, test='Chisq')
anova(mod.dur.length, mod.dur.length.goal, test='Chisq')
anova(mod.dur.length.goal, mod.dur.length.goal.inst, test='Chisq')
```

The final base model before adding metaphor variables:

```{r}
summary(mod.dur.length.goal.inst)
```

## Add metaphors

Use `nAQG=0` because `nAQG=1` cannot converge in a reasonable number (10,000) of iterations

See https://stats.stackexchange.com/questions/77313/why-cant-i-match-glmer-family-binomial-output-with-manual-implementation-of-g and https://www.rdocumentation.org/packages/lme4/versions/1.1-19/topics/glmer


```{r}
mod.no_metaphor = glmer(status ~ no_metaphor + goal_sc + text_length_words_sc + duration_cat + inst + (1|year),
                        data = dat, family = "binomial", nAGQ = 0)
mod.any_metaphor = glmer(status ~ any_metaphor + goal_sc + text_length_words_sc + duration_cat + inst + (1|year),
                        data = dat, family = "binomial", nAGQ = 0)
mod.dom_journey = glmer(status ~ dom_journey + goal_sc + text_length_words_sc + duration_cat + inst + (1|year),
                        data = dat, family = "binomial", nAGQ = 0)
mod.dom_journey.prod = glmer(status ~ journey_prod + dom_journey + goal_sc + text_length_words_sc + duration_cat + inst + (1|year),
                        data = dat, family = "binomial", nAGQ = 0)
mod.dom_battle = glmer(status ~ dom_battle + goal_sc + text_length_words_sc + duration_cat + inst + (1|year),
                        data = dat, family = "binomial", nAGQ = 0)
mod.dom_battle.prod = glmer(status ~ battle_prod + dom_battle + goal_sc + text_length_words_sc + duration_cat + inst + (1|year),
                        data = dat, family = "binomial", nAGQ = 0)
mod.only_journey = glmer(status ~ only_journey + goal_sc + text_length_words_sc + duration_cat + inst + (1|year),
                        data = dat, family = "binomial", nAGQ = 0)
mod.only_battle = glmer(status ~ only_battle + goal_sc + text_length_words_sc + duration_cat + inst + (1|year),
                        data = dat, family = "binomial", nAGQ = 0)
mod.both_metaphor = glmer(status ~ both_metaphor + goal_sc + text_length_words_sc + duration_cat + inst + (1|year),
                        data = dat, family = "binomial", nAGQ = 0)

anova(mod.dur.length.goal.inst, mod.no_metaphor)
anova(mod.dur.length.goal.inst, mod.any_metaphor)
anova(mod.dur.length.goal.inst, mod.dom_journey)
anova(mod.dom_journey, mod.dom_journey.prod)
anova(mod.dur.length.goal.inst, mod.dom_battle)
anova(mod.dom_battle, mod.dom_battle.prod)
anova(mod.dur.length.goal.inst, mod.only_journey)
anova(mod.dur.length.goal.inst, mod.only_battle)
anova(mod.dur.length.goal.inst, mod.both_metaphor)
```

# Number of Backers

```{r}
library(glmmTMB)
```

```{r}
nrow(dat[dat$backers > 1200, ])
ggplot() + labs(x="Number of Backers", title="Number of Backers Density") +
  geom_density(aes(dat$backers[dat$backers < 1200]))
```

We limit to 1200 because removing the outliers leaves us with a nicely shaped distribution.

```{r}
dat.b <- dat[dat$backers < 1200, ]
```

```{r}
dat.b %>%
  ggplot(aes(goal, backers)) + labs(title="Goal Amount Distribution") +
  geom_density2d(aes(color=..level..)) +
  theme_minimal()

dat.b %>%
  ggplot(aes(text_length_words, backers)) + labs(title="Text Length Distribution") +
  geom_density2d(aes(color=..level..)) + ylim(0, 250) +
  theme_minimal()

dat.b %>%
  ggplot(aes(cancer_type, backers)) + labs(title="Cancer Types") +
  geom_boxplot() +
  theme_minimal() +
  theme(axis.text.x=element_text(angle = 60, hjust=1))

```

## Model backers

```{r}
# no fixed effects, only random
mod.none <- glmmTMB(backers ~ (1|year), data = dat.b, family="nbinom2")

# add duration category
mod.dur <- glmmTMB(backers ~ duration_cat + (1|year), data = dat.b, family="nbinom2")

# add length of text (in words)
mod.dur.length <- glmmTMB(backers ~ text_length_words_sc + duration_cat + (1|year), data = dat.b, family="nbinom2")

# add scaled goal amount
mod.dur.length.goal <- glmmTMB(backers ~ goal_sc + text_length_words_sc + duration_cat + (1|year), data = dat.b, family="nbinom2")

# add first instantiation
mod.dur.length.goal.inst <- glmmTMB(backers ~ inst + goal_sc + text_length_words_sc + duration_cat + (1|year), data = dat.b, family="nbinom2")

anova(mod.none, mod.dur, test='Chisq')
anova(mod.dur, mod.dur.length, test='Chisq')
anova(mod.dur.length, mod.dur.length.goal, test='Chisq')
anova(mod.dur.length.goal, mod.dur.length.goal.inst, test='Chisq')
```

```{r}
summary(mod.dur.length.goal.inst)
```

## Add metaphors

```{r}
mod.no_metaphor = glmmTMB(backers ~ no_metaphor + goal_sc + text_length_words_sc + duration_cat + inst + (1|year),
                        data = dat.b, family = "nbinom2")
mod.any_metaphor = glmmTMB(backers ~ any_metaphor +goal_sc + text_length_words_sc + duration_cat + inst + (1|year),
                        data = dat.b, family = "nbinom2")
mod.dom_journey = glmmTMB(backers ~ dom_journey + goal_sc + text_length_words_sc + duration_cat + inst + (1|year),
                        data = dat.b, family = "nbinom2")
mod.dom_journey.prod = glmmTMB(backers ~ journey_prod + dom_journey + goal_sc + text_length_words_sc + duration_cat + inst + (1|year),
                        data = dat.b, family = "nbinom2")
mod.dom_battle = glmmTMB(backers ~ dom_battle + goal_sc + text_length_words_sc + duration_cat + inst + (1|year),
                        data = dat.b, family = "nbinom2")
mod.dom_battle.prod = glmmTMB(backers ~ battle_prod + dom_battle + goal_sc + text_length_words_sc + duration_cat + inst + (1|year),
                        data = dat.b, family = "nbinom2")
mod.only_journey = glmmTMB(backers ~ only_journey + goal_sc + text_length_words_sc + duration_cat + inst + (1|year),
                        data = dat.b, family = "nbinom2")
mod.only_battle = glmmTMB(backers ~ only_battle + goal_sc + text_length_words_sc + duration_cat + inst + (1|year),
                        data = dat.b, family = "nbinom2")
mod.both_metaphor = glmmTMB(backers ~ both_metaphor + goal_sc + text_length_words_sc + duration_cat + inst + (1|year),
                        data = dat.b, family = "nbinom2")

anova(mod.dur.length.goal.inst, mod.no_metaphor)
anova(mod.dur.length.goal.inst, mod.any_metaphor)
anova(mod.dur.length.goal.inst, mod.dom_journey)
anova(mod.dom_journey, mod.dom_journey.prod)
anova(mod.dur.length.goal.inst, mod.dom_battle)
anova(mod.dom_battle, mod.dom_battle.prod)
anova(mod.dur.length.goal.inst, mod.only_journey)
anova(mod.dur.length.goal.inst, mod.only_battle)
anova(mod.dur.length.goal.inst, mod.both_metaphor)
```

# Mean Donation

```{r}
dat %>%
  ggplot() + labs(title="Mean Donation Density") +
  geom_density(aes(mean_donation+1))

dat = dat[dat$mean_donation < 500, ]

dat %>%
  ggplot() + geom_qq(aes(sample=mean_donation+1), distribution = qexp) + geom_qq_line(aes(sample=mean_donation+1), distribution = qexp)
```

```{r}
dat %>%
  ggplot(aes(goal, mean_donation)) + labs(title="Goal Amount Distribution") +
  geom_density2d(aes(color=..level..)) +
  theme_minimal()

dat %>%
  ggplot(aes(text_length_words, mean_donation)) + labs(title="Text Length Distribution") +
  geom_density2d(aes(color=..level..)) +
  theme_minimal()

dat %>%
  ggplot(aes(cancer_type, mean_donation)) + labs(title="Cancer Types") +
  geom_boxplot() +
  theme_minimal() +
  theme(axis.text.x=element_text(angle = 60, hjust=1))
```

```{r}
library(car)
```

 - https://stats.stackexchange.com/questions/142013/correct-glmer-distribution-family-and-link-for-a-continuous-zero-inflated-data-s
 
The data fit an exponential fairly well, so we model with Gamma and a log link (see above answer for reason).

## Model mean donation

```{r}
# no fixed effects, only random
mod.none = glmer(mean_donation+1 ~ (1|year), data = dat, family = Gamma(link = "log"))

# add duration category
mod.dur = glmer(mean_donation+1 ~ duration_cat + (1|year), data = dat, family = Gamma(link = "log"))

# add length of text (in words)
mod.dur.length = glmer(mean_donation+1 ~ text_length_words_sc + duration_cat + (1|year), data = dat, family = Gamma(link = "log"))

# add scaled goal amount
mod.dur.length.goal = glmer(mean_donation+1 ~ goal_sc + text_length_words_sc + duration_cat + (1|year), data = dat, family = Gamma(link = "log"))

# add first instantiation
mod.dur.length.goal.inst = glmer(mean_donation+1 ~ inst + goal_sc + text_length_words_sc + duration_cat + (1|year), data = dat, family = Gamma(link = "log"))

anova(mod.none, mod.dur, test='Chisq')
anova(mod.dur, mod.dur.length, test='Chisq')
anova(mod.dur.length, mod.dur.length.goal, test='Chisq')
anova(mod.dur.length.goal, mod.dur.length.goal.inst, test='Chisq')
```

```{r}
summary(mod.dur.length.goal.inst)
```

## Add metaphors

```{r}
mod.no_metaphor = glmer(mean_donation+1 ~ no_metaphor + goal_sc + text_length_words_sc + duration_cat + inst + (1|year),
                        data = dat, family = Gamma(link = "log"))
mod.any_metaphor = glmer(mean_donation+1 ~ any_metaphor + goal_sc + text_length_words_sc + duration_cat + inst + (1|year),
                        data = dat, family = Gamma(link = "log"))
mod.dom_journey = glmer(mean_donation+1 ~ dom_journey + goal_sc + text_length_words_sc + duration_cat + inst + (1|year),
                        data = dat, family = Gamma(link = "log"))
mod.dom_journey.prod = glmer(mean_donation+1 ~ journey_prod + dom_journey + goal_sc + text_length_words_sc + duration_cat  + inst + (1|year),
                        data = dat, family = Gamma(link = "log"))
mod.dom_battle = glmer(mean_donation+1 ~ dom_battle + goal_sc + text_length_words_sc + duration_cat + inst + (1|year),
                        data = dat, family = Gamma(link = "log"))
mod.dom_battle.prod = glmer(mean_donation+1 ~ battle_prod + dom_battle + goal_sc + text_length_words_sc + duration_cat + inst + (1|year),
                        data = dat, family = Gamma(link = "log"))
mod.only_journey = glmer(mean_donation+1 ~ only_journey + goal_sc + text_length_words_sc + duration_cat + inst + (1|year),
                        data = dat, family = Gamma(link = "log"))
mod.only_battle = glmer(mean_donation+1 ~ only_battle + goal_sc + text_length_words_sc + duration_cat + inst + (1|year),
                        data = dat, family = Gamma(link = "log"))
mod.both_metaphor = glmer(mean_donation+1 ~ both_metaphor + goal_sc + text_length_words_sc + duration_cat + inst + (1|year),
                        data = dat, family = Gamma(link = "log"))

anova(mod.dur.length.goal.inst, mod.no_metaphor)
anova(mod.dur.length.goal.inst, mod.any_metaphor)
anova(mod.dur.length.goal.inst, mod.dom_journey)
anova(mod.dom_journey, mod.dom_journey.prod)
anova(mod.dur.length.goal.inst, mod.dom_battle)
anova(mod.dom_battle, mod.dom_battle.prod)
anova(mod.dur.length.goal.inst, mod.only_journey)
anova(mod.dur.length.goal.inst, mod.only_battle)
anova(mod.dur.length.goal.inst, mod.both_metaphor)
```
