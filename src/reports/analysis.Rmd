---
title: "analysis"
output: html_document
---


**Questions to ask**: 

Characterizing:
1. What's the distribution of metaphors overall? Does it differ by campaign category?
2. What about metaphor productivity? Within a metaphor family, are there canonical instantiations of a metaphor? (E.g. "fight battle"). Or even if productivity is low generally, are instantiations varied?
3. How do metaphors relate to the *length* of campaigns?

Predicting campaigns:
1. How does having a metaphor influence campaign success/failure, #backers, and mean donation?
2. How does having a *specific metaphor* (battles vs. journeys) influence campaign success/failure, #backers, mean donation?

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Metaphor Analysis


```{r cars}
setwd("/Users/seantrott/Dropbox/UCSD/Research/ComputationalLinguistics/nlp_cancer_metaphor")
dat = read.csv('data/processed/projects_with_metaphors.csv')
head(dat)
```

```{r}
colnames(dat)
unique(dat$category)
# TODO: merge publishing + comics, design + art + crafts, theater + dance
```

```{r}
library(ggplot2)
library(lme4)
```

```{r}
ggplot(dat, aes(x=dominant)) + geom_bar(stat="count", position="dodge")
```

```{r}
ggplot(dat, aes(x=category)) + geom_bar(stat="count")
```

Seems like a comprehensive source:
https://bbolker.github.io/mixedmodels-misc/glmmFAQ.html#model-definition
https://ase.tufts.edu/gsc/gradresources/guidetomixedmodelsinr/mixed%20model%20guide.html


# Status

```{r}
dat$goal_sc <- scale(dat$goal)

# no fixed effects
mod.none <- glmer(status ~ (1|category) + (1|year) + (1|month) + 
                    (1|day_of_week) + (1|from_US) + (1|geo_state) + (1|staff_pick), 
                  control=glmerControl(optimizer="bobyqa"),
                  data = dat, 
                  family = "binomial")

# add duration of campaign (in days)
mod.dur <- glmer(status ~ duration_float + (1|category) + (1|year) + (1|month) + 
                    (1|day_of_week) + (1|from_US) + (1|geo_state) + (1|staff_pick), 
                  control=glmerControl(optimizer="bobyqa"),
                  data = dat, 
                  family = "binomial")


# add length of text (in words)
# Doesn't converge, text_length_words is not scaled the same
mod.dur.textwords <- glmer(status ~ duration_float + text_length_words +
                             (1|category) + (1|year) + (1|month) + 
                             (1|day_of_week) + (1|from_US) + (1|geo_state) + (1|staff_pick), 
                            control=glmerControl(optimizer="bobyqa"),
                            data = dat, 
                            family = "binomial")


# add length of text (in sentences)
mod.dur.textwords.textsents <- glmer(status ~ duration_float + text_length_words +
                                       text_length_sentences + (1|category) + (1|year) + 
                                       (1|month) + (1|day_of_week) + (1|from_US) + 
                                       (1|geo_state) + (1|staff_pick), 
                                     control=glmerControl(optimizer="bobyqa"),
                                      data = dat, family = "binomial")

# add scaled goal amount
mod.dur.textwords.textsents.goal <- glmer(status ~ duration_float + text_length_words + text_length_sentences + goal_sc + (1|category) + (1|year) + (1|month) + (1|day_of_week) + (1|from_US) + (1|geo_state) + (1|staff_pick), 
                     data = dat, family = "binomial")
```

```{r}
### add battle as the dominant
mod.dur.textwords.textsents.goal.battle <- glmer(status ~ duration_float + text_length_words + text_length_sentences + goal_sc + dominant_battle + (1|category) + (1|year) + (1|month) + (1|day_of_week) + (1|from_US) + (1|geo_state) + (1|staff_pick), 
                               data = dat, family = "binomial")

### add journey as the dominant
mod.dur.textwords.textsents.goal.journey <- glmer(status ~ duration_float + text_length_words + text_length_sentences + goal_sc + dominant_journey + (1|category) + (1|year) + (1|month) + (1|day_of_week) + (1|from_US) + (1|geo_state) + (1|staff_pick), 
                                data = dat, family = "binomial")

### add both as the dominant
mod.dur.textwords.textsents.goal.both <- glmer(status ~ duration_float + text_length_words + text_length_sentences + goal_sc + dominant_both + (1|category) + (1|year) + (1|month) + (1|day_of_week) + (1|from_US) + (1|geo_state) + (1|staff_pick), 
                             data = dat, family = "binomial")

### add neither as the dominant
mod.dur.textwords.textsents.goal.neither <- glmer(status ~ duration_float + text_length_words + text_length_sentences + goal_sc + dominant_neither + (1|category) + (1|year) + (1|month) + (1|day_of_week) + (1|from_US) + (1|geo_state) + (1|staff_pick), 
                             data = dat, family = "binomial")

### add all dominant
mod.dur.textwords.textsents.goal.all <- glmer(status ~ duration_float + text_length_words + text_length_sentences + goal_sc + dominant + (1|category) + (1|year) + (1|month) + (1|day_of_week) + (1|from_US) + (1|geo_state) + (1|staff_pick), 
                             data = dat, family = "binomial")

anova(mod.none, mod.dur, test='Chisq')
anova(mod.dur, mod.dur.textwords, test='Chisq')
anova(mod.dur.textwords, mod.dur.textwords.textsents, test='Chisq')
anova(mod.dur.textwords.textsents, mod.dur.textwords.textsents.goal, test='Chisq')
anova(mod.dur.textwords.textsents.goal, mod.dur.textwords.textsents.goal.battle, test='Chisq')
anova(mod.dur.textwords.textsents.goal, mod.dur.textwords.textsents.goal.journey, test='Chisq')
anova(mod.dur.textwords.textsents.goal, mod.dur.textwords.textsents.goal.both, test='Chisq')
anova(mod.dur.textwords.textsents.goal, mod.dur.textwords.textsents.goal.neither, test='Chisq')
anova(mod.dur.textwords.textsents.goal, mod.dur.textwords.textsents.goal.all, test='Chisq')
```

# Number of Backers

```{r}
# no fixed effects
mod.none <- glmer(backers ~ (1|category) + (1|year) + (1|month) + (1|day_of_week) + (1|from_US) + (1|geo_state) + (1|staff_pick), 
                  data = dat, family = "poisson")

# add duration of campaign (in days)
mod.dur <- glmer(backers ~ duration_float +  (1|category) + (1|year) + (1|month) + (1|day_of_week) + (1|from_US) + (1|geo_state) + (1|staff_pick), 
                 data = dat, family = "poisson")

# add length of text (in words)
mod.dur.textwords <- glmer(backers ~ duration_float + text_length_words + (1|category) + (1|year) + (1|month) + (1|day_of_week) + (1|from_US) + (1|geo_state) + (1|staff_pick), 
                     data = dat, family = "poisson")

# add length of text (in sentences)
mod.dur.textwords.textsents <- glmer(backers ~ duration_float + text_length_words + text_length_sentences + (1|category) + (1|year) + (1|month) + (1|day_of_week) + (1|from_US) + (1|geo_state) + (1|staff_pick), 
                     data = dat, family = "poisson")

# add scaled goal amount
mod.dur.textwords.textsents.goal <- glmer(backers ~ duration_float + text_length_words + text_length_sentences + goal_sc + (1|category) + (1|year) + (1|month) + (1|day_of_week) + (1|from_US) + (1|geo_state) + (1|staff_pick), 
                     data = dat, family = "poisson")
```


```{r}
### add battle as the dominant
mod.dur.textwords.textsents.goal.battle <- glmer(backers ~ duration_float + text_length_words + text_length_sentences + goal_sc + dominant_battle + (1|category) + (1|year) + (1|month) + (1|day_of_week) + (1|from_US) + (1|geo_state) + (1|staff_pick), 
                               data = dat, family = "poisson")

### add journey as the dominant
mod.dur.textwords.textsents.goal.journey <- glmer(backers ~ duration_float + text_length_words + text_length_sentences + goal_sc + dominant_journey + (1|category) + (1|year) + (1|month) + (1|day_of_week) + (1|from_US) + (1|geo_state) + (1|staff_pick), 
                                data = dat, family = "poisson")

### add both as the dominant
mod.dur.textwords.textsents.goal.both <- glmer(backers ~ duration_float + text_length_words + text_length_sentences + goal_sc + dominant_both + (1|category) + (1|year) + (1|month) + (1|day_of_week) + (1|from_US) + (1|geo_state) + (1|staff_pick), 
                             data = dat, family = "poisson")

### add neither as the dominant
mod.dur.textwords.textsents.goal.neither <- glmer(backers ~ duration_float + text_length_words + text_length_sentences + goal_sc + dominant_neither + (1|category) + (1|year) + (1|month) + (1|day_of_week) + (1|from_US) + (1|geo_state) + (1|staff_pick), 
                             data = dat, family = "poisson")

### add all dominant
mod.dur.textwords.textsents.goal.all <- glmer(backers ~ duration_float + text_length_words + text_length_sentences + goal_sc + dominant + (1|category) + (1|year) + (1|month) + (1|day_of_week) + (1|from_US) + (1|geo_state) + (1|staff_pick), 
                             data = dat, family = "poisson")

anova(mod.none, mod.dur, test='Chisq')
anova(mod.dur, mod.dur.textwords, test='Chisq')
anova(mod.dur.textwords, mod.dur.textwords.textsents, test='Chisq')
anova(mod.dur.textwords.textsents, mod.dur.textwords.textsents.goal, test='Chisq')
anova(mod.dur.textwords.textsents.goal, mod.dur.textwords.textsents.goal.battle, test='Chisq')
anova(mod.dur.textwords.textsents.goal, mod.dur.textwords.textsents.goal.journey, test='Chisq')
anova(mod.dur.textwords.textsents.goal, mod.dur.textwords.textsents.goal.both, test='Chisq')
anova(mod.dur.textwords.textsents.goal, mod.dur.textwords.textsents.goal.neither, test='Chisq')
anova(mod.dur.textwords.textsents.goal, mod.dur.textwords.textsents.goal.all, test='Chisq')
```

# Mean Donation

```{r}
library(car)
```

Quickly playing around with the distribution of mean_donation.

```{r}
qqp(dat$mean_donation)
qqp(dat$mean_donation, "lnorm")
```

mean_donation isn't really gaussian, but for simplicity's sake, we'll use that for now. Pick a better dist later. Unsurprisingly, there aren't any significant effects when adding in dominant metaphors.

```{r}
# no fixed effects
mod.none <- lmer(mean_donation ~ (1|category) + (1|year) + (1|month) + (1|day_of_week) + (1|from_US) + (1|geo_state) + (1|staff_pick), 
                  data = dat)

# add duration of campaign (in days)
mod.dur <- lmer(mean_donation ~ duration_float +  (1|category) + (1|year) + (1|month) + (1|day_of_week) + (1|from_US) + (1|geo_state) + (1|staff_pick), 
                 data = dat)

# add length of text (in words)
mod.dur.textwords <- lmer(mean_donation ~ duration_float + text_length_words + (1|category) + (1|year) + (1|month) + (1|day_of_week) + (1|from_US) + (1|geo_state) + (1|staff_pick), 
                     data = dat)

# add length of text (in sentences)
mod.dur.textwords.textsents <- lmer(mean_donation ~ duration_float + text_length_words + text_length_sentences + (1|category) + (1|year) + (1|month) + (1|day_of_week) + (1|from_US) + (1|geo_state) + (1|staff_pick), 
                     data = dat)

# add scaled goal amount
mod.dur.textwords.textsents.goal <- lmer(mean_donation ~ duration_float + text_length_words + text_length_sentences + goal_sc + (1|category) + (1|year) + (1|month) + (1|day_of_week) + (1|from_US) + (1|geo_state) + (1|staff_pick), 
                     data = dat)
```


```{r}
### add battle as the dominant
mod.dur.textwords.textsents.goal.battle <- lmer(mean_donation ~ duration_float + text_length_words + text_length_sentences + goal_sc + dominant_battle + (1|category) + (1|year) + (1|month) + (1|day_of_week) + (1|from_US) + (1|geo_state) + (1|staff_pick), 
                               data = dat)

### add journey as the dominant
mod.dur.textwords.textsents.goal.journey <- lmer(mean_donation ~ duration_float + text_length_words + text_length_sentences + goal_sc + dominant_journey + (1|category) + (1|year) + (1|month) + (1|day_of_week) + (1|from_US) + (1|geo_state) + (1|staff_pick), 
                                data = dat)

### add both as the dominant
mod.dur.textwords.textsents.goal.both <- lmer(mean_donation ~ duration_float + text_length_words + text_length_sentences + goal_sc + dominant_both + (1|category) + (1|year) + (1|month) + (1|day_of_week) + (1|from_US) + (1|geo_state) + (1|staff_pick), 
                             data = dat)

### add neither as the dominant
mod.dur.textwords.textsents.goal.neither <- lmer(mean_donation ~ duration_float + text_length_words + text_length_sentences + goal_sc + dominant_neither + (1|category) + (1|year) + (1|month) + (1|day_of_week) + (1|from_US) + (1|geo_state) + (1|staff_pick), 
                             data = dat)

### add all dominant
mod.dur.textwords.textsents.goal.all <- lmer(mean_donation ~ duration_float + text_length_words + text_length_sentences + goal_sc + dominant + (1|category) + (1|year) + (1|month) + (1|day_of_week) + (1|from_US) + (1|geo_state) + (1|staff_pick), 
                             data = dat)

anova(mod.none, mod.dur, test='Chisq')
anova(mod.dur, mod.dur.textwords, test='Chisq')
anova(mod.dur.textwords, mod.dur.textwords.textsents, test='Chisq')
anova(mod.dur.textwords.textsents, mod.dur.textwords.textsents.goal, test='Chisq')
anova(mod.dur.textwords.textsents.goal, mod.dur.textwords.textsents.goal.battle, test='Chisq')
anova(mod.dur.textwords.textsents.goal, mod.dur.textwords.textsents.goal.journey, test='Chisq')
anova(mod.dur.textwords.textsents.goal, mod.dur.textwords.textsents.goal.both, test='Chisq')
anova(mod.dur.textwords.textsents.goal, mod.dur.textwords.textsents.goal.neither, test='Chisq')
anova(mod.dur.textwords.textsents.goal, mod.dur.textwords.textsents.goal.all, test='Chisq')
```

