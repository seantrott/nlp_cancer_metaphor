---
title: "Analysis"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(MASS)
library(tidyverse)
library(boot)
theme = theme_minimal()
```

# Experimental Analysis

Hypotheses:

H1: The metaphorical conditions are more likely to have a higher mean donation than the literal condition.

H2: Consistent findings to Hendricks and Boroditsky 2016:	 	 	 		

People who read the battle metaphor agreed more with the statement that the patient “will feel guilty if he does not recover,” than did people who read about the journey
									
People who read the journey metaphor agreed more with the statement that the patient “can make peace with his situation,” than the group who read the battle metaphor

Men, more than women, will say the patient will feel guilty


People who have had intimate experiences with cancer (either they or a family member has been treated) donate more.


## Load and Clean Data

Created via `clean_data.R`.

```{r}
data = read_csv("clean_pilot_real.csv", col_types = cols())

data$cond_sex = factor(data$cond_sex, levels = c("male", "female"))
data$cond_metaphor = factor(data$cond_metaphor, levels = c("literal", "battle", "journey"))

data$cond = paste(data$cond_sex, "_", data$cond_metaphor, sep="")

data$rt_trial = data$rt_trial / (1000 * 60) # convert to floating point minutes
data$total_time = data$total_time / (1000 * 60) # convert to floating point minutes

data$urgent = as.integer(data$urgent)
data$serious = as.integer(data$serious)
data$sympathy = as.integer(data$sympathy)
data$peace = as.integer(data$peace)
data$guilty = as.integer(data$guilty)

data$exp_cancer = data$self_cancer == "Y" | data$ff_cancer == "Y"


data$gender = factor(data$gender, levels = c("M", "F", "NB", "NA"))
data$self_cancer = factor(data$self_cancer, levels = c("Y", "N", "NA"))
data$ff_cancer = factor(data$ff_cancer, levels = c("Y", "N", "NA"))
data$english = factor(data$english, levels = c("Y", "N", "NA"))
data$socioeconomic = factor(data$socioeconomic, levels = c("<10k", "10-25k", "25-50k", "50-75k", "75-100k", "100-150k", ">150k", "NA"))
data$education = factor(data$education, levels = c("<HS", "HS", "A", "B", "M", "P", "D", "NA"))


nrow(data)
head(data)
```

## Exploration

### Experiment Duration

```{r}
summary(data$total_time)
ggplot(data) + theme +
  geom_density(aes(total_time)) +
  labs(x = "Total Duration (mins)", y = "Density", title = "Total Duration Distribution")
```


First, 5th, 50th, and 95th quantiles for the actual trial response time. Then the mean trial response time. Then 5th, 50th, and 95th quantiles for experiment total duration. Lastly, mean total experiment duration.

```{r}
quantile(data$rt_trial, c(0.05, 0.5, 0.95))
mean(data$rt_trial)
quantile(data$total_time, c(0.05, 0.5, 0.95))
mean(data$total_time)
```

Timing of resposnes with bootstrapped CIs

```{r}
meanf = function(data, ix) {
  return(mean(data[ix]))
}

b1 = boot(data[data$cond_metaphor == "literal", ]$rt_trial, meanf, R = 1000)
b2 = boot(data[data$cond_metaphor == "battle", ]$rt_trial, meanf, R = 1000)
b3 = boot(data[data$cond_metaphor == "journey", ]$rt_trial, meanf, R = 1000)

ci1 = boot.ci(b1, type = "bca")
ci2 = boot.ci(b2, type = "bca")
ci3 = boot.ci(b3, type = "bca")

ggplot(data.frame(condition = c("literal", "battle", "journey"), 
                  estimate = c(b1$t0, b2$t0, b3$t0),
                  ub = c(ci1$bca[5], ci2$bca[5], ci3$bca[5]),
                  lb = c(ci1$bca[4], ci2$bca[4], ci3$bca[4]))) +
  theme +
  geom_col(aes(condition, estimate)) +
  geom_errorbar(aes(condition, ymin = lb, ymax = ub, width = 0.1))
```

Participants per cell

```{r}
table(data[, c("cond_metaphor", "cond_sex")])
```

```{r}
data %>%
  group_by(cond_metaphor, cond_sex) %>%
  summarize(n = n()) %>%
  ggplot() + theme +
  geom_col(aes(cond_metaphor, n, fill = cond_sex))
```


### Prominent Donation Behaviors

First, summary stats of the donations. Then, proportion of participants who donate $0, $25, and $50. These are natural breaks (minimum, default/middle, maximum) that might signal certain behavior (e.g. people often giving nothing, staying with the default value).

```{r}
summary(data$donation)
mean(data$donation == 0)
mean(data$donation == 25)
mean(data$donation == 50)
```

Given that 15% of participants donated \$25, we should see if this means anything. If the participant is rushing through the experiment and donates the default amount, we might expect to see that a donation of $25 predicts the trial response time.

```{r}
time.model = lm(rt_trial ~ cond_sex*cond_metaphor, data = data)
time.model.full = lm(rt_trial ~ I(donation == 25) + cond_sex*cond_metaphor, data = data)
anova(time.model, time.model.full)
```

### Donation

How do participants in each of the conditions behave?

First, simple density plots of donation amounts, both overall and broken up by condition.

```{r}
ggplot(data) + theme + 
  geom_density(aes(donation)) +
  labs(x = "Donation Amount", y = "Density", title = "Donation Distribution") +
  lims(x=c(0, 50))

ggplot(data) + theme + 
  geom_density(aes(donation, color = cond_metaphor, lty = cond_sex)) +
  labs(x = "Donation Amount", y = "Density", title = "Donation Distributions by Condition", color = "Condition") +
  lims(x=c(0, 50))
```

Simple plots of condition main effects with boostrapped CIs

```{r}
# main effect of cond_sex

b1 = boot(data[data$cond_sex == "male", ]$donation, meanf, R = 1000)
b2 = boot(data[data$cond_sex == "female", ]$donation, meanf, R = 1000)

ci1 = boot.ci(b1, type = "bca")
ci2 = boot.ci(b2, type = "bca")

ggplot(data.frame(condition = c("male", "female"),
                  estimate = c(b1$t0, b2$t0),
                  ub = c(ci1$bca[5], ci2$bca[5]),
                  lb = c(ci1$bca[4], ci2$bca[4]))) + theme +
  geom_col(aes(condition, estimate)) +
  geom_errorbar(aes(condition, ymin = lb, ymax = ub, width = 0.1))

# main effect of cond_metaphor

b1 = boot(data[data$cond_metaphor == "literal", ]$donation, meanf, R = 1000)
b2 = boot(data[data$cond_metaphor == "battle", ]$donation, meanf, R = 1000)
b3 = boot(data[data$cond_metaphor == "journey", ]$donation, meanf, R = 1000)

ci1 = boot.ci(b1, type = "bca")
ci2 = boot.ci(b2, type = "bca")
ci3 = boot.ci(b3, type = "bca")

ggplot(data.frame(condition = c("literal", "battle", "journey"),
                  estimate = c(b1$t0, b2$t0, b3$t0),
                  ub = c(ci1$bca[5], ci2$bca[5], ci3$bca[5]),
                  lb = c(ci1$bca[4], ci2$bca[4], ci3$bca[4]))) + theme +
  geom_col(aes(condition, estimate)) +
  geom_errorbar(aes(condition, ymin = lb, ymax = ub, width = 0.1))

# interaction of cond_sex and cond_metaphor

b1 = boot(data[data$cond_metaphor == "literal" & data$cond_sex == "male", ]$donation, meanf, R = 1000)
b2 = boot(data[data$cond_metaphor == "battle" & data$cond_sex == "male", ]$donation, meanf, R = 1000)
b3 = boot(data[data$cond_metaphor == "journey" & data$cond_sex == "male", ]$donation, meanf, R = 1000)
b4 = boot(data[data$cond_metaphor == "literal" & data$cond_sex == "female", ]$donation, meanf, R = 1000)
b5 = boot(data[data$cond_metaphor == "battle" & data$cond_sex == "female", ]$donation, meanf, R = 1000)
b6 = boot(data[data$cond_metaphor == "journey" & data$cond_sex == "female", ]$donation, meanf, R = 1000)

ci1 = boot.ci(b1, type = "bca")
ci2 = boot.ci(b2, type = "bca")
ci3 = boot.ci(b3, type = "bca")
ci4 = boot.ci(b4, type = "bca")
ci5 = boot.ci(b5, type = "bca")
ci6 = boot.ci(b6, type = "bca")

ggplot(data.frame(cond_metaphor = c("literal", "battle", "journey", "literal", "battle", "journey"),
                  cond_sex = c("male", "male", "male", "female", "female", "female"),
                  estimate = c(b1$t0, b2$t0, b3$t0, b4$t0, b5$t0, b6$t0),
                  ub = c(ci1$bca[5], ci2$bca[5], ci3$bca[5], ci4$bca[5], ci5$bca[5], ci6$bca[5]),
                  lb = c(ci1$bca[4], ci2$bca[4], ci3$bca[4], ci4$bca[4], ci5$bca[4], ci6$bca[4]))) + theme +
  geom_col(aes(cond_metaphor, estimate, fill = cond_sex), position = "dodge", group = 1) +
  geom_errorbar(aes(cond_metaphor, ymin = lb, ymax = ub, width = 0.1, group = cond_sex),  position = position_dodge(width = 0.9))
```


## Covariates

Quick peek at the differences in donation amounts given how much participants agreed with the followup questions.

```{r}
data %>%
  gather(question, value, urgent:guilty) %>%
  ggplot(aes(as.factor(value), donation)) +
  geom_boxplot() +
  facet_grid(rows = vars(question))
```

Distribution of the followup questions

```{r}
ggplot(data) + theme +
  geom_bar(aes(urgent, group=1, y=..prop..)) +
  scale_x_discrete(limits = seq(0,6)) +
  labs(x = "Urgent", y = "Proportion", title = "Urgent Distribution", subtitle = "\"Her situation is urgent.\"")

ggplot(data) + theme +
  geom_bar(aes(serious, group=1, y=..prop..)) +
  scale_x_discrete(limits = seq(0,6)) +
  labs(x = "Serious", y = "Proportion", title = "Serious Distribution", subtitle = "\"Her situation is serious.\"")

ggplot(data) + theme +
  geom_bar(aes(sympathy, group=1, y=..prop..)) +
  scale_x_discrete(limits = seq(0,6)) +
  labs(x = "Sympathy", y = "Proportion", title = "Sympathy Distribution", subtitle = "\"Her situation is one I sympathize with.\"")
```

```{r}
ggplot(data) + theme +
  geom_bar(aes(as.factor(urgent), fill = cond_metaphor), position = "dodge") +
  labs(x = "Urgent", y = "Count", title = "Urgent Distribution", subtitle = "\"Her situation is urgent.\"")

ggplot(data) + theme +
  geom_bar(aes(as.factor(serious), fill = cond_metaphor), position = "dodge") +
  labs(x = "Serious", y = "Count", title = "Serious Distribution", subtitle = "\"Her situation is serious.\"")

ggplot(data) + theme +
  geom_bar(aes(as.factor(sympathy), fill = cond_metaphor), position = "dodge") +
  labs(x = "Sympathy", y = "Count", title = "Sympathy Distribution", subtitle = "\"Her situation is one I sympathize with.\"")
```

Peek at the fastest participants

```{r}
data %>%
  arrange(rt_trial) %>%
  head()
```

### Model the three investment scores

Sympathy - as normally distributed

```{r}
sympathy.model = lm(sympathy ~ gender + education, data = data)
sympathy.model.full = lm(sympathy ~ cond_metaphor + gender + education, data = data)

summary(sympathy.model.full)
anova(sympathy.model, sympathy.model.full)
anova(sympathy.model.full)
```

Sympathy - as ordinally distributed

```{r}
# sympathy.model.ord = polr(as.factor(sympathy) ~ cond_metaphor*cond_sex, data = data, Hess = T)
# 
# summary(sympathy.model.ord)
# exp(coef(sympathy.model.ord))
```

Urgency - as normally distributed

```{r}
urgent.model = lm(urgent ~ gender + education, data = data)
urgent.model.full = lm(urgent ~ cond_metaphor*cond_sex + gender + education, data = data)

summary(urgent.model.full)
anova(urgent.model, urgent.model.full)
anova(urgent.model.full)
```

Urgency - as ordinally distributed

```{r}
# urgent.model.ord = polr(as.factor(urgent) ~ cond_metaphor*cond_sex, data = data, Hess = T)
# 
# summary(urgent.model.ord)
# exp(coef(urgent.model.ord))
```

Seriousness - as normally distributed

```{r}
serious.model = lm(serious ~ gender + education, data = data)
serious.model.full = lm(serious ~ cond_metaphor + gender + education, data = data)

summary(serious.model.full)
anova(serious.model, serious.model.full)
anova(serious.model.full)
```

Seriousness - as ordinally distributed

```{r}
# serious.model.ord = polr(as.factor(serious) ~ cond_metaphor*cond_sex, data = data, Hess = T)
# 
# summary(serious.model.ord)
# exp(coef(serious.model.ord))
```

Model the participants' total investments in the patient

```{r}
data$investment = data$serious + data$urgent + data$sympathy

investment.model = lm(investment ~ gender + education, data = data)
investment.model.full = lm(investment ~ cond_metaphor + gender + education, data = data)

summary(investment.model.full)
anova(investment.model, investment.model.full)
anova(investment.model.full)
```

### Model Peace and Guilt

```{r}
ggplot(data) + theme +
  geom_bar(aes(peace, fill = cond_metaphor), position = "dodge") +
  labs(x = "Peace", y = "Count", title = "Peace Distribution", subtitle = "\"She can make peace with her experience.\"")

ggplot(data) + theme +
  geom_bar(aes(guilty, fill = cond_metaphor), position = "dodge") +
  labs(x = "Guilty", y = "Count", title = "Guilty Distribution", subtitle = "\"She will feel guilty that she hasn’t done enough if she does not recover.\"")
```

Guilt scores by metaphor condition with bootstrapped CIs

```{r}
b1 = boot(data[data$cond_metaphor == "literal", ]$guilty, meanf, R = 1000)
b2 = boot(data[data$cond_metaphor == "battle", ]$guilty, meanf, R = 1000)
b3 = boot(data[data$cond_metaphor == "journey", ]$guilty, meanf, R = 1000)

ci1 = boot.ci(b1, type = "bca")
ci2 = boot.ci(b2, type = "bca")
ci3 = boot.ci(b3, type = "bca")

ggplot(data.frame(condition = c("literal", "battle", "journey"),
                  estimate = c(b1$t0, b2$t0, b3$t0),
                  ub = c(ci1$bca[5], ci2$bca[5], ci3$bca[5]),
                  lb = c(ci1$bca[4], ci2$bca[4], ci3$bca[4]))) + theme +
  geom_point(aes(condition, estimate), shape=4, size=3) +
  lims(y=c(0,6)) +
  geom_errorbar(aes(condition, ymin = lb, ymax = ub, width = 0.1)) +
  labs(title = "Guilt scores by metaphor condition")
```

Peace scores by metaphor condition with bootstrapped CIs

```{r}
b1 = boot(data[data$cond_metaphor == "literal", ]$peace, meanf, R = 1000)
b2 = boot(data[data$cond_metaphor == "battle", ]$peace, meanf, R = 1000)
b3 = boot(data[data$cond_metaphor == "journey", ]$peace, meanf, R = 1000)

ci1 = boot.ci(b1, type = "bca")
ci2 = boot.ci(b2, type = "bca")
ci3 = boot.ci(b3, type = "bca")

ggplot(data.frame(condition = c("literal", "battle", "journey"),
                  estimate = c(b1$t0, b2$t0, b3$t0),
                  ub = c(ci1$bca[5], ci2$bca[5], ci3$bca[5]),
                  lb = c(ci1$bca[4], ci2$bca[4], ci3$bca[4]))) + theme +
  geom_point(aes(condition, estimate), shape=4, size=3) +
  lims(y=c(0,6)) +
  geom_errorbar(aes(condition, ymin = lb, ymax = ub, width = 0.1)) +
  labs(title = "Peace scores by metaphor condition")
```

Guilt - as normally distributed

```{r}
guilt.model = lm(guilty ~ gender + exp_cancer, data = data)
guilt.model.full = lm(guilty ~ cond_metaphor + gender + exp_cancer, data = data)

summary(guilt.model.full)
anova(guilt.model, guilt.model.full)
anova(guilt.model.full)
```

Guilt - as ordinally distributed

```{r}
# guilt.model.ord = polr(as.factor(guilty) ~ cond_metaphor, data = data, Hess = T)
# 
# summary(guilt.model.ord)
# exp(coef(guilt.model.ord))
```

```{r}
peace.model = lm(peace ~ gender + exp_cancer, data = data)
peace.model.full = lm(peace ~ cond_metaphor + gender + exp_cancer, data = data)

summary(peace.model.full)
anova(peace.model, peace.model.full)
anova(peace.model.full)
```

Peace - as ordinally distributed

```{r}
# peace.model.ord = polr(as.factor(peace) ~ cond_metaphor*gender, data = data, Hess = T)
# 
# summary(peace.model.ord)
# exp(coef(peace.model.ord))
```

## Demographics

```{r}
ggplot(data) +
  geom_density(aes(donation, color=self_cancer)) +
  lims(x = c(0, 50)) +
  labs(x = "Donation Amount", y = "Density", color = "Self Cancer", title = "Donation Distributions by Education Level")

ggplot(data) +
  geom_density(aes(donation, color=ff_cancer)) +
  lims(x = c(0, 50)) +
  labs(x = "Donation Amount", y = "Density", color = "Friends and Family\nCancer", title = "Donation Distributions by Friends and Family Cancer")

ggplot(data) +
  geom_density(aes(donation, color=gender)) +
  lims(x = c(0, 50)) +
  labs(x = "Donation Amount", y = "Density", color = "Gender", title = "Donation Distributions by Gender")

ggplot(data) +
  geom_density(aes(donation, color=education)) +
  lims(x = c(0, 50)) +
  labs(x = "Donation Amount", y = "Density", color = "Education Level", title = "Donation Distributions by Education Level")

ggplot(data) +
  geom_density(aes(donation, color=socioeconomic)) +
  lims(x = c(0, 50)) +
  labs(x = "Donation Amount", y = "Density", color = "Socioeconomic Level", title = "Donation Distributions by Socioeconomic Level")

ggplot(data) +
  geom_density(aes(donation, color=english)) +
  lims(x = c(0, 50)) +
  labs(x = "Donation Amount", y = "Density", color = "Native English", title = "Donation Distributions by Native English")

ggplot(data, aes(exp_cancer, donation)) +
  geom_boxplot(alpha = 0.5) +
  geom_jitter(width = 0.1) +
  lims(y = c(0, 50)) +
  labs(title = "Donation distributions by Overall Cancer Experience")
```

```{r}
exp.cancer.model = lm(donation ~ cond_metaphor, data = data[!is.na(data$exp_cancer), ])
exp.cancer.model.full = lm(donation ~ exp_cancer*cond_metaphor, data = data[!is.na(data$exp_cancer), ])

summary(exp.cancer.model.full)
anova(exp.cancer.model, exp.cancer.model.full)
anova(exp.cancer.model.full)
```


## Regression

**Do the conditions predict whether the participants donates at all?**

```{r}
data$donated = data$donation > 0

donated.model = glm(donated ~ gender + exp_cancer, data = data, family = "binomial")
donated.model.full = glm(donated ~ cond_metaphor + gender + exp_cancer, data = data, family = "binomial")

summary(donated.model.full)
anova(donated.model, donated.model.full)
anova(donated.model.full)
```


**Does simply having either metaphor family present explain donation behavior?**

```{r}
data$cond_anymet = data$cond_metaphor %in% c("battle", "journey")

model = lm(donation ~ gender + education + socioeconomic + age + exp_cancer, data = data)
model.full = lm(donation ~ cond_anymet + gender + education + socioeconomic + age + exp_cancer, data = data)

summary(model.full)
anova(model, model.full)
anova(model.full)
```

**Does either the battle or the journey metaphor family explain donation behavior beyond the literal condition?**

```{r}
full.model = lm(donation ~ cond_metaphor*cond_sex + gender + education + socioeconomic + age + exp_cancer, data = data)

summary(full.model)
summary(aov(full.model))
```

