<!DOCTYPE html>
<html lang="en" dir="ltr">
    <head>
        <meta charset="utf-8">
        <title>Survey</title>
        <script src="jspsych-6.0.5/jspsych.js"></script>
        <script src="jspsych-6.0.5/plugins/jspsych-html-keyboard-response.js"></script>
        <script src="jspsych-6.0.5/plugins/jspsych-html-button-response.js"></script>
        <script src="jspsych-6.0.5/plugins/jspsych-survey-text.js"></script>
        <script src="jspsych-6.0.5/plugins/jspsych-survey-likert.js"></script>
        <script src="jspsych-6.0.5/plugins/jspsych-survey-multi-choice.js"></script>
        <script src="jspsych-6.0.5/plugins/jspsych-html-slider-response.js"></script>
        <script src="jspsych-6.0.5/plugins/jspsych-call-function.js"></script>
        <script src="jspsych-6.0.5/plugins/jspsych-instructions.js"></script>
        <script src="jspsych-6.0.5/plugins/jspsych-external-html.js"></script>
        <link href="jspsych-6.0.5/css/jspsych.css" rel="stylesheet" type="text/css"></link>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>

        <style>
        .main-trial {
          width: 1100px;
        }
        .instructions {
          width: 1000px;
          margin: 0 auto;
          text-align: left;
        }
        ul {
          list-style-position: inside;
        }
        .jspsych-content {
          padding-bottom: 80px;
        }
        </style>
    </head>
    <body>
    </body>
    <script>

/* Save data .*/
function saveData(filename, filedata){
   $.ajax({
      type:'post',
      cache: false,
      url: 'save_data.php', // this is the path to the above PHP script
      data: {filename: filename, filedata: filedata}
   });
}

// Set up variables
var session_id;
var ppt_id = jsPsych.randomization.randomID(20)
var condition_sex = jsPsych.randomization.sampleWithoutReplacement(['male', 'female'], 1)[0];
var condition_metaphor = jsPsych.randomization.sampleWithoutReplacement(['battle', 'journey', 'literal'], 1)[0];

var character = {'name': 'Jason', 'pn': 'He', 'pos': 'His'}

if (condition_sex == "female") {
  character = {'name': 'Jennifer', 'pn': 'She', 'pos': 'Her'}
}

jsPsych.data.addProperties({
  ppt: ppt_id,
  sex: condition_sex,
  metaphor: condition_metaphor
});

var consent = {
    type: 'external-html',
    url: "consent.html",
    cont_btn: "consent"
}

/// MAIN EXPERIMENT

page1 = "<p>Thank you for agreeing to participate in this study!</p> \
        <p>Shortly, you will be presented with a crowdfunding campaign raising \
        money for an individual.</p>\
        <br>\
        <p>You will carefully read this campaign and select an amount up to $50 \
        USD to donate.</p>"
page2 = "<p>You and all other participants are entered in an opportunity drawing upon completion \
        of this study. After all participant responses are recorded, one participant will \
        be randomly selected as the winner.</p>\
        <p>If you are the winner, the amount you choose to donate \
        will be given to an individual who's in a situation similar to the one you will read about.</p>\
        <p>Additionally, if you are the winner, you will receive as a cash bonus the amount you \
        choose to not donate to the individual. This bonus is in addition to the \
        fixed compensation for your participation.</p>\
        <p>For example: if you are the randomly selected winner, and you choose \
        to donate $50, then you would receive $0. Similarly, if you choose to donate \
        $0, then you would receive $50.</p>"
page3 = "<p>There is no expense to enter this drawing other than your participation \
        in this study. The chances of winning are about 1 in 200. Should you be the randomly \
        selected winner, we will contact you via email.</p>"

var instructions = {
  type: 'instructions',
  pages: ["<div class='instructions'>" + page1 + "</div>",
          "<div class='instructions'>" + page2 + "</div>",
          "<div class='instructions'>" + page3 + "</div>",
          '<p>Click the "Next" button to begin the study.</p>'],
  show_clickable_nav: true
}

// Text / html GoFundMe page + slider for donation

condition_image = "condition_" + condition_sex + "_" + condition_metaphor + ".png"

var main_trial = {
    type: 'html-slider-response',
    stimulus: '<h3>Please carefully read the following campaign, and indicate below how \
    much you would donate.</h3><p>Once you are satisfied, press "Continue" at the bottom.</p>\
    <br><img src="' + condition_image + '" class="main-trial"/>',
    min: 0,
    max: 50,
    start: 25,
    labels: ['$0', '$5', '$10', '$15', '$20', '$25', '$30', '$35', '$40', '$45', '$50'],
    prompt: "<div class='instructions'><h4>How much would you like to donate to this campaign?</h4>\
            <p>Remember, if you are the randomly selected winner:</p><p><ul>\
            <li>The amount you choose to donate will go to a real individual who also has cancer.</li>\
            <li>You will receive as a cash bonus the amount you choose to not donate.</li>\
            </ul></p></div>"
};

// Secondary page asking about: 1) whether person is at peace; 2) whether person should feel guilty; and 3) what the urgency is.
// survey-likert

scale_1 = [1, 2, 3, 4, 5, 6, 7]


var q1 = {
  type: 'survey-likert',
  preamble: 'Please indicate your agreement with the following questions about ' + character["name"] + ' by choosing any response from 1 (Strongly Disagree) to 7 (Strongly Agree).',
  questions: [{prompt: character["pn"] + " will feel guilty that " + character["pn"].toLowerCase() + " hasn’t done enough if " + character["pn"].toLowerCase() + " does not recover.", labels: scale_1, required: true}],
  data: {'qtype': 'guilty'}
}

var q2 = {
  type: 'survey-likert',
  preamble: 'Please indicate your agreement with the following questions about ' + character["name"] + ' by choosing any response from 1 (Strongly Disagree) to 7 (Strongly Agree).',
  questions: [{prompt: character["pn"] + " can make peace with " + character["pos"].toLowerCase() + " experience.", labels: scale_1, required: true}],
  data: {'qtype': 'peace'}
}



var followup_questions = {
  timeline: jsPsych.randomization.shuffle([q1, q2])
}

/*
var followup_questions = {
  type: 'survey-likert',
  preamble: 'Please indicate your agreement with the following questions about ' + character["name"] + ' by choosing any response from 1 (Strongly Disagree) to 7 (Strongly Agree).',
  timeline: [
    {questions: [{prompt: character["pn"] + " will feel guilty that " + character["pn"].toLowerCase() + " hasn’t done enough if " + character["pn"].toLowerCase() + " does not recover.", labels: scale_1, required: true}]},
    {questions: [{prompt: character["pn"] + " can make peace with " + character["pos"].toLowerCase() + " experience.", labels: scale_1, required: true}]},
    {questions: [{prompt: character["pos"] + " situation is urgent.", labels: scale_1, required: true}]},
    {questions: [{prompt: character["pos"] + " situation is serious.", labels: scale_1, required: true}]},
    {questions: [{prompt: character["pos"] + " situation is one I sympathize with.", labels: scale_1, required: true}]}
  ],
  randomize_order: true
  // data: {q_order: []}
}
*/
////// participant information

// have they been treated for cancer? Etc.

var cancer_info = {
type: 'survey-multi-choice',
questions: jsPsych.randomization.shuffle([
            {required: true, prompt: 'Have you ever been treated for cancer?', options:['Yes', 'No', 'Prefer not to say']},
            {required: true, prompt: 'Have any of your close friends or family members been treated for cancer?', options:['Yes', 'No', 'Prefer not to say']}
          ])
}

/// Demogrpahics
var demographics = {
  type: 'survey-multi-choice',
  questions: [{required: true,
                prompt: 'Please select the gender which you identify most with.',
                options:['Male', 'Female', 'Non-binary', 'Prefer not to say']},
              {required: true,
                prompt: 'What is the highest degree or level of school you have completed? \
                (If you’re currently enrolled in school, please indicate the highest degree you have received.)',
                options:['Less than a high school diploma',
                          'High school degree or equivalent (e.g. GED)',
                          'Associate degree (e.g. AA, AS)',
                          'Bachelor’s degree (e.g. BA, BS)',
                          'Master’s degree (e.g. MA, MS, MEd)',
                          'Professional degree (e.g. MD, DDS, DVM)',
                          'Doctorate (e.g. PhD, EdD)',
                          'Prefer not to say']},
              {required: true,
                prompt: 'How much did you earn, before taxes and other deductions, during the past 12 months?',
                options:['Less than $10,000',
                        '$10,000 through $24,999',
                        '$25,000 through $49,999',
                        '$50,000 through $74,999',
                        '$75,000 through $99,999',
                        '$100,000 through $149,999',
                        'More than $150,000',
                        'Prefer not to say']},
              {required: true,
                prompt: 'Are you a native speaker of English?',
                options:['Yes', 'No', 'Prefer not to say']}
              ]
}

var age = {
    type: 'survey-text',
    questions: [{'prompt':'How old are you? Please answer in years, using only numbers. (optional)'}]
}

var feedback = {
    type: 'survey-text',
    questions: [{'prompt':'Do you have any additional feedback about this experiment for the researchers? (optional)',
                  'columns': 80,
                  'rows': 14}]
}

var debrief = {
    type: 'external-html',
    url: "debrief.html",
    cont_btn: "finish"
}

// without Node.js
// var timeline = [instructions, main_trial, followup_questions, cancer_info, demographics, age, feedback]

// with Node.js
var timeline = [consent, instructions, main_trial, followup_questions, cancer_info, demographics, age, feedback, debrief]


var timeline = [followup_questions, cancer_info]

jsPsych.init({
    timeline: timeline,
    show_progress_bar: true,
    on_finish: function(data) {
      var filename = ppt_id + "_metaphor.csv";

      saveData(filename, jsPsych.data.get().csv());

      console.log(filename)

      console.log(jsPsych.data.get().csv())

      $(".jspsych-display-element").html("The results have been recorded! Data was recorded under the participant ID: <b>" + ppt_id + "</b>");
      /*
      $.ajax({
        type:'post',
        cache: false,
        url: "save_data.php",
        data: {filename: "session_" + session_id + "_pilot.csv", filedata: jsPsych.data.get().csv()}
      });
      $.ajax({
        type:'post',
        cache: false,
        url: "save_data.php",
        data: {filename: "session_" + session_id + "_pilot.json", filedata: jsPsych.data.get().json()}
      });
      $(".jspsych-display-element").html("The results have been recorded! Data was recorded under the session ID: <b>" + session_id + "</b>");

    */
    }

  }
  );

    </script>
</html>
