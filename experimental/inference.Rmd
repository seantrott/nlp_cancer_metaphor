---
title: "Inference"
output:
  html_document:
    toc: true
    toc_float: true
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(MASS)
library(tidyverse)
theme = theme_minimal()
```

# Experimental Analysis

Hypotheses:

H1a: The metaphorical conditions are more likely to have a higher mean donation than the literal condition.

H1b: There is a difference in mean donation given whether the metaphor was battle or journey.

 - Note: this is unsupported by the observational work, but differences in behavior due to the metaphor family are worth testing.

H2: Consistent findings to Hendricks and Boroditsky 2016:	 	 	 		

People who read the battle metaphor agreed more with the statement that the patient “will feel guilty if he does not recover,” than did people who read about the journey
									
People who read the journey metaphor agreed more with the statement that the patient “can make peace with his situation,” than the group who read the battle metaphor

Men, more than women, will say the patient will feel guilty

## Load clean data

Created via `clean_data.R`.

```{r}
sc = function(x) {
  return((x - mean(x, na.rm = T)) / (2 * sd(x, na.rm = T)))
}


df_cleaned = read_csv("data/clean_data.csv", col_types = cols()) %>%
              mutate(
              cond_sex = factor(cond_sex, levels = c("male", "female")),
              cond_metaphor = factor(cond_metaphor, levels = c("literal", "battle", "journey")),
              cond = paste(cond_sex, "_", cond_metaphor, sep=""),
              
              rt_trial = rt_trial / (1000 * 60), # convert to floating point minutes
              total_time = total_time / (1000 * 60), # convert to floating point minutes
              
              age.z = sc(age),
              exp_cancer = (self_cancer == "Y" | ff_cancer == "Y"),
              
              urgent = as.integer(urgent),
              sympathy = as.integer(sympathy),
              peace = as.integer(peace),
              guilty = as.integer(guilty),
              
              gender = factor(gender, levels = c("M", "F", "NB")),
              self_cancer = factor(self_cancer, levels = c("Y", "N")),
              ff_cancer = factor(ff_cancer, levels = c("Y", "N")),
              english = factor(english, levels = c("Y", "N")),
              socioeconomic = factor(socioeconomic, levels = c("<10k", "10-25k", "25-50k", "50-75k", "75-100k", "100-150k", ">150k")),
              education = factor(education, levels = c("<HS", "HS", "A", "B", "M", "P", "D")))
```

## Check over details of experiment
 
```{r}
length(unique(df_cleaned$ppt))

table(df_cleaned$gender)
table(df_cleaned$cond_metaphor)
```



## Regression

### H1

// TODO: consider modeling socioeconomic status as an ordinal variable. Right now it's categorical.

**Does simply having either metaphor family present explain donation behavior?**

```{r}
df_cleaned$cond_anymet = df_cleaned$cond_metaphor %in% c("battle", "journey")
```

```{r}
h1a.model = lm(donation ~ cond_sex + gender + education + socioeconomic + age.z + self_cancer + ff_cancer, data = df_cleaned)
h1a.model.full = lm(donation ~ cond_anymet + cond_sex + gender + education + socioeconomic + age.z + self_cancer + ff_cancer, data = df_cleaned)

summary(h1a.model.full)
anova(h1a.model, h1a.model.full, test = "Chisq")
```

**Does either the battle or the journey metaphor family explain donation behavior beyond the literal condition?**

To be compared with the similar analysis from the observational work.

```{r}
h1b.model = lm(donation ~ cond_sex + gender + education + socioeconomic + age.z + self_cancer + ff_cancer, data = df_cleaned)
h1b.model.full = lm(donation ~ cond_metaphor + cond_sex + gender + education + socioeconomic + age.z + self_cancer + ff_cancer, data = df_cleaned)

summary(h1b.model.full)
anova(h1b.model, h1b.model.full, test = "Chisq")

```

#### Visualization

```{r}
df_cleaned %>%
  ggplot(aes(x = cond_anymet,
             y = donation)) +
  stat_summary (fun.y = function(x){mean(x)},
                fun.ymin = function(x){mean(x) - 1*sd(x)/sqrt(length(x))},
                fun.ymax = function(x){mean(x) + 1*sd(x)/sqrt(length(x))},
                geom= 'pointrange', 
                position=position_dodge(width=0.95)) +
  labs(x = "Contains either BATTLE or JOURNEY metaphor",
       y = "Donation amount",
       title = "Donation amounts by metaphor condition") +
  theme_minimal()
```



### H2

Can we replicate Hendricks & Boroditsky?

Does the metaphorical and sex conditions have a relationship to participant's rating of perceived guilt?


// A few things things:
// 1) H+B (2018) look at cond_metaphor * gender. We probably should too. With maybe cond_sex being the new thing.
// 2) H+B (2018) also don't have a "literal" condition. So the pure replication is just looking at the battle/journey trials. Then we can look 
// at {battle, journey, literal} or {metaphor, no_metaphor}.
// 3) H+B (2018) use a "difference" score instead of peace/guilt.
// This is reflected in my changes below (I didn't delete your stuff, just moved it to the bottom).

// This also means we should be checking comparisons for each of these variables.


```{r}

# Replicate H+B (2018) "difference" score: peace - guilt.

df_cleaned$diff = df_cleaned$peace - df_cleaned$guilty
df_just_metaphor = df_cleaned %>%
  filter(cond_metaphor != "literal")

model.reduced = lm(diff ~ cond_sex + gender + education + socioeconomic + self_cancer + ff_cancer, 
                 data = df_just_metaphor)
model.just_met = lm(diff ~ cond_metaphor + cond_sex + gender + education + socioeconomic + self_cancer + ff_cancer, 
                          data = df_just_metaphor)
model.ppt_gender_metaphor_interaction = lm(diff ~ cond_metaphor*gender + cond_sex + education + socioeconomic + self_cancer + ff_cancer, 
                          data = df_just_metaphor)
model.patient_gender_metaphor_interaction = lm(diff ~ cond_metaphor*cond_sex + gender + education + socioeconomic + self_cancer + ff_cancer, 
                      data = df_just_metaphor)
model.both_interactions = lm(diff ~ cond_metaphor*cond_sex + cond_metaphor*gender + education + socioeconomic + self_cancer + ff_cancer, 
                      data = df_just_metaphor)

summary(model.both_interactions)
anova(model.reduced, model.just_met)
anova(model.just_met, model.ppt_gender_metaphor_interaction)
anova(model.just_met, model.patient_gender_metaphor_interaction)
anova(model.patient_gender_metaphor_interaction, model.both_interactions)


anova(model.both_interactions)

```


```{r}
df_just_metaphor %>%
  ggplot(aes(x = cond_metaphor,
             y = diff,
             color = gender)) +
  stat_summary (fun.y = function(x){mean(x)},
                fun.ymin = function(x){mean(x) - 1*sd(x)/sqrt(length(x))},
                fun.ymax = function(x){mean(x) + 1*sd(x)/sqrt(length(x))},
                geom= 'pointrange', 
                position=position_dodge(width=0.95)) +
  labs(x = "Metaphor condition",
       y = "Peace - guilt score",
       title = "Peace/guilt score by metaphor conditon and gender") +
  theme_minimal()

```


