---
title: "Mediation"
output:
  html_document:
    toc: true
    toc_float: true
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(MASS)
library(tidyverse)
library(mediation)
library(jtools)
theme = theme_minimal()
```

# Mediation Analysis

## Load clean data

Created via `clean_data.R`.

```{r}
trials = read_csv("data_pilot_N200/data_clean.csv", col_types = cols()) %>%
  select(ppt:age) %>%
  mutate(
    cond_sex = factor(cond_sex, levels = c("male", "female")),
    cond_metaphor = factor(cond_metaphor, levels = c("literal", "battle", "journey")),
    cond_anymet = cond_metaphor %in% c("battle", "journey"),
    
    self_cancer = factor(self_cancer, levels = c("N", "Y", "NA")),
    ff_cancer = factor(ff_cancer, levels = c("N", "Y", "NA")),
    
    urgent = as.integer(urgent),
    sympathy = as.integer(sympathy),
    
    gender = factor(gender, levels = c("M", "F", "NB"), labels = c("Male", "Female", "Nonbinary")),
    education = factor(education, levels = c("<HS", "HS", "A", "B", "M", "P", "D", "NA")),
    socioeconomic = factor(socioeconomic, levels = c("<10k", "10-25k", "25-50k", "50-75k", "75-100k", "100-150k", ">150k", "NA")),
    english = factor(english, levels = c("Y", "N", "NA")),
    
    age.z = (age - mean(age, na.rm = T)) / (2 * sd(age, na.rm = T)),
    # past_donations.z = (past_donations - mean(past_donations, na.rm = T)) / (2 * sd(past_donations, na.rm = T))
  )
```

```{r}
base.formula = formula(~ self_cancer + ff_cancer + gender + education + socioeconomic + age.z)
```

# Any Metaphor

## Sympathy

Is there an indirect effect of the presence of metaphor on the donation amount via one's sympathy for the patient?

              Sympathy
            ^         v
Any Metaphor --------> Donation Amount

```{r}
model.m.x = lm(update(base.formula, sympathy ~ . + cond_anymet), data = trials)
model.y.m.x = lm(update(base.formula, donation ~ . + sympathy + cond_anymet), data = trials)
model.y.x = lm(update(base.formula, donation ~ . + cond_anymet), data = trials)


summ(model.m.x)
summ(model.y.m.x)
summ(model.y.x)
```

<!-- X does not predict Y, although we have reason to believe it might. X does not predict M. Given Y ~ M + X, X does not predict Y. Therefore, mediation analysis does not apply here. -->

## Urgency

Is there an indirect effect of the presence of metaphor on the donation amount via one's perception of urgency for the patient?

```{r}
model.m.x = lm(update(base.formula, urgent ~ . + cond_anymet), data = trials)
model.y.m.x = lm(update(base.formula, donation ~ . + urgent + cond_anymet), data = trials)
model.y.x = lm(update(base.formula, donation ~ . + cond_anymet), data = trials)


summ(model.m.x)
summ(model.y.m.x)
summ(model.y.x)
```

<!-- X does not predict Y, although we have reason to believe it might. X does, however, predict M. Given Y ~ M + X, X does not predict Y, although the effect is slightly less. We attempt mediation analysis. -->

```{r}
med.anlys = mediate(model.m.x, model.y.m.x, treat = "cond_anymet", mediator = "urgent")

summary(med.anlys)
```

<!-- Urgency is a partial mediator of donation given the *any metaphor* condition. -->

# Battle and Journey Metaphors

## Sympathy

Is there an indirect effect of the presence of battle metaphors over literal metaphors on the donation amount via one's sympathy for the patient?

```{r}
mask = trials$cond_metaphor != "journey"
model.m.x = lm(update(base.formula, sympathy ~ . + cond_metaphor), data = trials[mask, ])
model.y.m.x = lm(update(base.formula, donation ~ . + sympathy + cond_metaphor), data = trials[mask, ])
model.y.x = lm(update(base.formula, donation ~ . + cond_metaphor), data = trials[mask, ])


summ(model.m.x)
summ(model.y.m.x)
summ(model.y.x)
```

Is there an indirect effect of the presence of journey metaphors over literal metaphors on the donation amount via one's sympathy for the patient?

```{r}
mask = trials$cond_metaphor != "battle"
model.m.x = lm(update(base.formula, sympathy ~ . + cond_metaphor), data = trials[mask, ])
model.y.m.x = lm(update(base.formula, donation ~ . + sympathy + cond_metaphor), data = trials[mask, ])
model.y.x = lm(update(base.formula, donation ~ . + cond_metaphor), data = trials[mask, ])


summ(model.m.x)
summ(model.y.m.x)
summ(model.y.x)
```

## Urgency

Is there an indirect effect of the presence of battle metaphors over literal metaphors on the donation amount via one's perception of urgency for the patient?

```{r}
mask = trials$cond_metaphor != "journey"
model.m.x = lm(update(base.formula, urgent ~ . + cond_metaphor), data = trials[mask, ])
model.y.m.x = lm(update(base.formula, donation ~ . + urgent + cond_metaphor), data = trials[mask, ])
model.y.x = lm(update(base.formula, donation ~ . + cond_metaphor), data = trials[mask, ])


summ(model.m.x)
summ(model.y.m.x)
summ(model.y.x)
```

```{r}
med.anlys = mediate(model.m.x, model.y.m.x, treat = "cond_metaphor", mediator = "urgent")

summary(med.anlys)
```

Is there an indirect effect of the presence of battle metaphors over literal metaphors on the donation amount via one's perception of urgency for the patient?

```{r}
mask = trials$cond_metaphor != "battle"
model.m.x = lm(update(base.formula, urgent ~ . + cond_metaphor), data = trials[mask, ])
model.y.m.x = lm(update(base.formula, donation ~ . + urgent + cond_metaphor), data = trials[mask, ])
model.y.x = lm(update(base.formula, donation ~ . + cond_metaphor), data = trials[mask, ])


summ(model.m.x)
summ(model.y.m.x)
summ(model.y.x)
```

<!-- X does not mediate Y, however we have reason to believe it might. X (battle) does predict M, however X (journey) doesn't. The effect of X on Y is less with M included. We test the mediation M of X (battle). -->

```{r}
med.anlys = mediate(model.m.x, model.y.m.x, treat = "cond_metaphor", mediator = "urgent")

summary(med.anlys)
```

<!-- Donation amounts are mediated by the urgent variable given the battle metaphor condition. -->
